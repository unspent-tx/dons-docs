import { CardanoSDKUtil, Serialization } from "@meshsdk/core-cst";
import { WalletStaticMethods } from "@meshsdk/wallet";

describe("BroswerWallet", () => {
  it("signTx: addWitnessSet", () => {
    const unsignedTx =
      "84a4008282582023925df9067578d15e766d5e7aacf3f1af5b0eb5a90abd9c9281e4881338317e01825820c9b837816abbdcd28ba3905752b24054ca0d8f5b510d15567041e96bb18b2a29000182825839005867c3b8e27840f556ac268b781578b14c5661fc63ee720dbeab663f9d4dcd7e454d2434164f4efb8edeb358d86a1dad9ec6224cfcbce3e61a0016e360825839001e4eb194e3335a0dcc4f5c5d009318167c583bb3b0879d9f718cd9e0d63a93470bd4d8bb986c02ff8a6043796b91cc397ceb29058f5c9ac01a4387095e021a0002a98d0d83825820423351f26b28a089171fb9a6cfb824de99524972c59958533beba877af74503c01825820d06a742f2b8fe2bad4c38e2db9e9dfe924235d2d0b894d207b251f9cfc93e85103825820ec0c2e70b898cf531b03c9db937602e98c45378d9fa8e8a5b5a91ec5c1d7540d05a0f5f6";
    const witness =
      "a10081825820cb845bb836d4baf4edffb9f76198072cbc70f0d8bb5402644ffd4db17e65259f58403c82976d080de380506a8fd78afc5e8a0ab4367916c943f368b8541e8aca8cbe4d98e4106a7da065918a676849c00201aed154cda38348220960aba80bb5190a";
    const cWitness = Serialization.TransactionWitnessSet.fromCbor(
      CardanoSDKUtil.HexBlob(witness),
    );
    const signedTx = WalletStaticMethods.addWitnessSets(unsignedTx, [
      ...cWitness.vkeys()?.values()!,
    ]);
    expect(signedTx).toEqual(
      "84a4008282582023925df9067578d15e766d5e7aacf3f1af5b0eb5a90abd9c9281e4881338317e01825820c9b837816abbdcd28ba3905752b24054ca0d8f5b510d15567041e96bb18b2a29000182825839005867c3b8e27840f556ac268b781578b14c5661fc63ee720dbeab663f9d4dcd7e454d2434164f4efb8edeb358d86a1dad9ec6224cfcbce3e61a0016e360825839001e4eb194e3335a0dcc4f5c5d009318167c583bb3b0879d9f718cd9e0d63a93470bd4d8bb986c02ff8a6043796b91cc397ceb29058f5c9ac01a4387095e021a0002a98d0d83825820423351f26b28a089171fb9a6cfb824de99524972c59958533beba877af74503c01825820d06a742f2b8fe2bad4c38e2db9e9dfe924235d2d0b894d207b251f9cfc93e85103825820ec0c2e70b898cf531b03c9db937602e98c45378d9fa8e8a5b5a91ec5c1d7540d05a10081825820cb845bb836d4baf4edffb9f76198072cbc70f0d8bb5402644ffd4db17e65259f58403c82976d080de380506a8fd78afc5e8a0ab4367916c943f368b8541e8aca8cbe4d98e4106a7da065918a676849c00201aed154cda38348220960aba80bb5190af5f6",
    );
  });
});
